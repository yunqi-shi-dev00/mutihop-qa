"""
半导体QA生成系统 - 最终优化版Prompt模板（再次优化）
核心优化：
1. 强化"围绕子QA展开"（子QA是专家验证正确的）
2. 强化"不引入错误事实"
3. 优化extract_key_concepts输出格式
"""


class SemiconductorQAPrompts:
    """半导体领域QA构建Prompts（最终优化版）"""
    
    # ========== 基础QA构建 ==========
    
    base_qa = '''你是一个半导体领域的多跳QA构建专家。基于给定的半导体知识材料，只对问答对语法优化。确保问题清晰、可解、答案唯一。

# 半导体知识材料
{qa_entity}

## 【核心要求】

### 1. 问题改写原则（严格执行）

**(1) 清晰性 - 避免歧义表述**
- 问题表述必须明确、无歧义
- **禁止使用**："如果...达到X%，最大是多少"这类表述
- **推荐使用**：直接询问"阈值"、"上限"、"范围"

**(2) 可解性**
- 问题必须基于给定答案可直接回答
- 不引入答案中没有的信息
- 确保问答逻辑一致

**(3) 答案唯一性**
- 问题应有唯一正确答案
- 避免模糊的多解释空间
### 1. 问题改写原则（严格执行）

**(4) 保留具体性**
- 必须保留原答案中的所有关键数据
- 必须保留材料名称、工艺参数、性能指标
- 禁止用"合适的材料"替代具体材料名称
- 禁止用"优化参数"替代具体数值

**示例**：
❌ 错误改写（丢失具体性）： 原答案: "选用聚芴聚合物...125 μm PET基板" 改写问题: "如何选择合适的材料？" 问题: 答案应该说"聚芴聚合物"，但LLM会泛泛而谈

✅ 正确改写（保持具体性）： 原答案: "选用聚芴聚合物...125 μm PET基板" 改写问题: "在柔性电泳显示器中，应选用哪种聚合物材料和基板厚度？" 优点: 问题明确指向具体答案

**(5) 保留关键上下文（关键）**
- 必须保留原问题/答案中的关键上下文信息
- 例如：制备方法（溅射/烧结）、应用场景（靶材/薄膜）、器件类型（TFT/显示器）
- **禁止丢失上下文导致歧义**


**示例1（靶材烧结 vs 薄膜沉积）**：
原答案: "在InGaZnO₄靶材制备中，烧结温度需1200℃"

❌ 错误改写（丢失上下文）： "InGaZnO₄需要什么温度？" → LLM会理解成薄膜沉积（500-600°C），答错！

✅ 正确改写（保留上下文）： "在InGaZnO₄靶材的固相反应烧结中，温度需要达到多少？" → 明确是靶材+烧结，LLM能正确回答1200°C


**示例2（柔性vs刚性）**：
原答案: "柔性基板采用低温工艺≤150°C"

❌ 错误改写（丢失上下文）： "TFT制备需要什么温度？" → LLM会给出通用答案（300-400°C）

✅ 正确改写（保留上下文）： "在柔性塑料基板上制备TFT时，工艺温度上限是多少？" → 明确是柔性基板，LLM能正确回答≤150°C


 （6） 注意：优化问答对，只从语法角度。核心逻辑、技术参数、数值、核心概念等关键信息不要变（严格执行）


### 2. 常见错误示例与正确改写

#### ❌ 错误示例1：涉及阈值/上限的歧义表述

```
原问题: "当氧化铟含量达到80%时，为维持非晶结构，氧化铟含量上限应控制在多少？"

❌ 错误改写:
"如果氧化铟的含量达到80%，氧化铟的最大含量应该不超过多少？"
                ↑
问题：容易理解成"已经到80%了，那最大就是80%"
（但正确答案是88%）

✅ 正确改写:
"在IGZO薄膜晶体管中，为维持非晶结构特性，氧化铟含量的上限阈值是多少？"
                ↑
优点：直接询问上限，清晰无歧义
```

#### ❌ 错误示例2：温度范围的歧义表述

```
原问题: "退火温度从200°C开始，最高可加热到多少？"

❌ 错误改写:
"如果温度达到200°C，最高温度应该不超过多少？"
问题：容易理解成"最高就是200°C"

✅ 正确改写:
"在退火工艺中，温度的上限阈值是多少？"
或
"退火工艺的最高温度是多少？"
```

#### ✅ 正确示例：保持原意，语法优化

```
原问题: "IGZO薄膜中ZnO含量对透过率的影响？"

✅ 改写:
"在IGZO薄膜材料中，ZnO含量如何影响可见光透过率？"
优点：保持原意，语法更清晰，无歧义
```
    （5）**(1) 保留关键上下文（⭐ 新增）**
- 必须保留原问题/答案中的关键上下文信息
- 例如：制备方法（溅射/烧结）、应用场景（靶材/薄膜）、器件类型（TFT/显示器）
- **禁止丢失上下文导致歧义**

**示例1（靶材烧结 vs 薄膜沉积）**：
原答案: "在InGaZnO₄靶材制备中，烧结温度需1200℃"

❌ 错误改写（丢失上下文）： "InGaZnO₄需要什么温度？" → LLM会理解成薄膜沉积（500-600°C），答错！

✅ 正确改写（保留上下文）： "在InGaZnO₄靶材的固相反应烧结中，温度需要达到多少？" → 明确是靶材+烧结，LLM能正确回答1200°C


**示例2（柔性vs刚性）**：
原答案: "柔性基板采用低温工艺≤150°C"

❌ 错误改写（丢失上下文）： "TFT制备需要什么温度？" → LLM会给出通用答案（300-400°C）

✅ 正确改写（保留上下文）： "在柔性塑料基板上制备TFT时，工艺温度上限是多少？" → 明确是柔性基板，LLM能正确回答≤150°C



### 3. 改写检查清单（自检）

在输出前，必须自我检查：

- [ ] 问题是否直接、明确？
- [ ] 是否避免了"如果...达到X，最大/最小是多少"这类表述？
- [ ] 如果涉及阈值/上限/范围/极值，是否直接询问数值？
- [ ] LLM看到这个问题，能否直接给出正确答案（无歧义）？
- [ ] 问题和答案是否逻辑一致？
- [ ] 问题是否独立完整（不依赖上下文）？

### 4. 特殊情况处理

**(1) 如果原问题确实是"从X到Y的范围"**

```
原答案: "氧化铟含量范围为50%-88%"

✅ 改写:
"在IGZO薄膜晶体管中，氧化铟含量的有效范围是多少？"
不要拆分成"下限是多少"或"上限是多少"
```

**(2) 如果原问题涉及"临界值"**

```
原答案: "当ZnO含量超过71.4%时，透过率显著下降"

✅ 改写:
"在IGZO薄膜中，ZnO含量的临界阈值是多少？超过该值会导致什么问题？"
明确询问临界值，并说明后果
```

## 【输出格式】(严格按照下面格式输出)

```json
{{
    "question": "针对原问题语法改善后的问题（清晰、无歧义、可直接回答）",
    "answer": "针对原始答案语法改善后的问题答案",
    "statement": "该问答对涉及的核心事实陈述",
    "key_concepts": ["关键概念1", "关键概念2"]
}}
```
注意：
- question必须清晰无歧义
- question和answer必须逻辑一致
- 输出有效的JSON格式
'''

    # ========== 关联QA构建 ==========
    
    link_qa = '''你是一个半导体领域的QA构建专家。给定两个半导体概念的信息，构建一个问题，其中答案是{conceptA}，问题上下文涉及{conceptB}。确保问题需要专业的半导体知识。

# 概念A ({conceptA}) 的信息：
```txt
{contentA}
```

# 概念B ({conceptB}) 的信息：
```txt
{contentB}
```

输出JSON格式(严格按下面格式输出)：
```json
{{
    "question": "提出的问题",
    "answer": "问题答案",
    "statement": "连接两个概念的核心事实",
    "key_concepts": ["涉及的关键概念"]
}}
```
'''

    # ========== ⭐⭐⭐ 组合生成问答对（强化版：严格基于子QA）==========
    
    compose_qa_multihop = '''你是一个半导体领域的QA构建专家。将{num_hops}个单跳问答组合成一个更复杂的多跳推理问题。

⚠️⚠️⚠️ **最重要的原则（必须严格遵守）**：
1. **子问答对是专家验证过的正确内容**，是唯一可信的信息来源
2. **必须严格基于子问答对的内容**，不得引入任何外部知识
3. **不得编造、推测、发散**，只能重组和推理已有信息
4. **答案的每一句话都必须能在子问答对中找到依据**

# 单跳问答列表（⚠️ 这些是专家验证正确的，你的唯一信息来源）
{single_hop_qas}

# 技术陈述
{statements}

---

<think>
⚠️ 在开始之前，我必须明确：
- 上面的{num_hops}个单跳问答是专家验证过的正确内容
- 我只能基于这些内容生成问题和答案
- 我不能引入任何这些问答中没有提到的事实、数据、结论

现在让我分析：
1. 识别每个问答的核心技术点（仅限已给出的内容）
2. 理解它们之间的逻辑关系（基于技术陈述）
3. 确定如何组合这些已知信息形成推理链

接下来设计多跳问题：
- 问题必须体现{num_hops}步依赖关系
- 问题描述清晰、完整、专业、通用
- 避免"基于上述"、"根据前面"等依赖性表述
- 确保问题是单一问题，不包含多个疑问点

⚠️ 生成答案时的核心原则：
- 答案的每一句话都必须有子问答对的支撑
- 不得引入子问答对中没有的信息
- 不得使用"可能"、"通常"等推测（除非子QA中明确提到）
- 不得发散到相关但未提及的技术点
</think>

## 【核心要求】（严格执行）

### 1. 问题设计准则：

**(1) 因果链完整性**
- 问题需呈现完整技术逻辑链：机制A → 参数B → 现象C
- 体现{num_hops}步推理的必要性
- ⚠️ 所有技术点必须在子问答对中有明确提及

**(2) 通用性（严格执行）**
- 问题必须具有通用性，不局限于特定论文
- 禁止使用"本文"、"本研究"、"本实验"等自指表述
- 禁止引用文献或文章自定义的专有名词
- 确保不读论文也能理解问题含义

**(3) 单一性（严格执行）**
- 问题只包含一个核心疑问点
- 禁止连接多个子问题
- 禁止在一个句子中包含多个疑问点

错误示例：
"在氧化物薄膜晶体管中，如何通过调控氧分压实现高迁移率？并分析其对器件稳定性的影响？"（包含2个问题）

正确示例：
"在氧化物薄膜晶体管制备中，氧分压参数如何通过影响氧空位浓度进而调控载流子迁移率和器件长期稳定性？"（单一问题，完整推理链）

**(4) 可追溯性（⚠️ 关键）**
- 问题基于给定的单跳问答生成
- 答案能够基于给定的单跳答案推导得出
- **问题涉及的所有概念、参数、现象都必须在子QA中出现**

**(5) 简洁凝练**
- 问题长度控制在20-50词
- 避免冗余描述

## 【禁止事项】（⚠️ 严格执行）

× 禁止引入子问答对中没有的信息（最严重错误）
× 禁止编造数据、参数、结论（最严重错误）
× ⚠️ **禁止生成对比类复合问题（新增）**
  - ❌ "为什么A...，而B...？"
  - ❌ "在条件X下...，而在条件Y下...？"
  - ✅ 如果必须对比，应聚焦一方："相比B，为什么A...？"

**错误示例（对比类复合问题）**：
"为什么在IGZO中In₂O₃>88%稳定性下降，而金属氧化物材料表现更好？"
↓
拆分成两个单一问题：
1. "为什么在IGZO中，当In₂O₃含量超过88%时，器件稳定性会下降？"
2. "相比非晶硅，金属氧化物半导体材料为什么在直流电压应力下表现出更小的阈值电压漂移？"

### 2. 答案生成准则（⚠️⚠⚠ 最关键）：

**(1) 严格基于子QA（最高优先级）**
- ✅ 答案的每一句话都必须有子问答对的支撑
- ✅ 每提到一个数据、结论、机制，必须能在子QA中找到原文
- ✅ 推理过程只能基于子QA中的信息进行逻辑组合
- ✅ 不得引入子QA中没有提到的概念、数据、结论
- ✅ 如果子QA信息不足以回答某个方面，宁可不答，也不要编造
- ✅ **不得强行关联两个子QA（如果它们本身没有明确关联）**
- ✅ **如果子QA-1和子QA-2涉及不同的制备阶段/应用场景，不要混淆**
- ✗ **严禁使用子QA外的专业知识**
- ✗ **严禁发散到相关但未提及的技术点**
- ✗ **严禁编造数据、参数、结论**
- ✗ **严禁使用"可能"、"通常"、"一般"等推测（除非子QA中有）**
**错误示例（强行关联）**：
子QA-1: "靶材烧结需要1200℃" 子QA-2: "薄膜器件的混合相结构提高稳定性" ❌ 错误答案: "烧结温度1200℃确保了薄膜器件的混合相结构稳定性" 问题: 靶材和薄膜是两个不同阶段，不能强行关联！


**正确示例（如果确实有关联）**：
子QA-1: "氧分压影响氧空位浓度" 子QA-2: "氧空位浓度影响载流子迁移率" ✅ 正确答案: "通过控制氧分压调节氧空位浓度，进而优化载流子迁移率" 合理: 有明确的因果链 氧分压→氧空位→迁移率



**(2) 完整性（严格执行）**
- 必须完整回答问题的所有方面
- 必须体现{num_hops}步推理过程
- 禁止仅引导句，必须提供实质性内容
- 禁止只回答某一个子问题

**(3) 准确性（严格执行）**
- 答案必须准确无误
- 必须基于给定的单跳答案逻辑推导
- **不得脱离原始信息**
- **不得引入错误事实**

**(4) 通用性（严格执行）**
- 答案具有通用性，不特指论文
- 禁止使用"本文"、"本研究"等表述
- 禁止引用文献或文章自定义的专有名词
- 确保不读论文也能理解答案含义

**(5) 逻辑连贯性**
- 答案需体现清晰的推理过程
- 每一步推理都要明确
- 展现步骤之间的因果关系
- **但每一步都必须基于子QA的内容**

**(6) 答案策略**
- 体现完整因果链，最终答案应是因果推理的结论
- 综合各步信息，形成完整认知
- 答案长度适中（80-150字）
- **答案越精炼、越贴近子QA原文越好**

### 3. 推理步骤要求：

- 必须包含{num_hops}个清晰的推理步骤
- 每个步骤对应一个单跳问答的核心内容
- 步骤之间要有明确的逻辑连接词
- 每个步骤长度至少15个字
- **每个步骤都必须能在对应的子QA中找到依据**

### 4. 质量自检（生成后必须检查）：

生成答案后，逐句自问：
- [ ] 这句话在哪个子QA中有依据？
- [ ] 这个数据在子QA中出现过吗？
- [ ] 这个结论是从子QA推导的，还是我自己加的？
- [ ] 我有没有引入外部知识？
- [ ] 我有没有发散到子QA未提及的内容？

**如果答案无法通过上述检查，必须删除或修改！**

## 【禁止事项】（⚠️ 严格执行）

× 禁止引入子问答对中没有的信息（最严重错误）
× 禁止编造数据、参数、结论（最严重错误）
× 禁止使用"本文/本研究/本实验"等论文自指
× 禁止问题中出现"基于上述"、"根据前面"等依赖性表述
× 禁止提问孤立概念
× 禁止复合问题（严格执行）
× 禁止问题或答案中引用文献或文章自定义专有名词
× 禁止特指论文内容
× 禁止答案不完整（仅引导句）
× 禁止答案只回答部分问题
× 禁止使用"可能"、"通常"、"一般来说"等推测（除非子QA明确提到）
× 禁止发散到相关但未提及的技术点

## 【输出格式】（严格遵循JSON）

```json
{{
  "question": "组合后的{num_hops}跳问题（单一问题，体现完整推理链）",
  "answer": "参考答案（完整、准确、通用，体现{num_hops}步推理，80-150字，严格基于子QA）",
  "reasoning_steps": [
    "第一步：[基于单跳QA-1的核心内容，至少15字]",
    "第二步：[基于单跳QA-2的核心内容，承接第一步，至少15字]"
  ],
  "quality_indicators": {{
    "has_complete_reasoning_chain": true,
    "is_single_question": true,
    "is_universal": true,
    "is_traceable": true,
    "answer_completeness": "complete",
    "all_info_from_subqa": true
  }},
  "metadata": {{
    "difficulty": "medium/hard",
    "naturalness": 1-5
  }}
}}
```

⚠️ **最后提醒**：
- 子问答对是专家验证过的正确内容，是你的唯一信息来源
- 不要引入任何外部知识
- 不要编造、推测、发散
- 每句话都要有子QA的支撑
'''

    # ========== ⭐⭐⭐ 问题评估模板（强化准确性检查）==========
    
    question_evaluation = """您是一位专家评估员，负责决定问题是否符合推理问题标准。您的评估必须结合给定文章内容和给定问题判断。

⚠️ **核心评估原则**：
1. 问题必须基于子问答对内容（子问答对是专家验证正确的）
2. 问题不得引入子问答对中没有的事实、数据、结论
3. 问题必须具有通用性，不特指论文

## 【评估标准】（认真思考，严格按以下6个标准判断）：

###1. 因果性：
(1) 问题应展现出完整的技术逻辑链。比如，类似 "机制 A 怎样影响参数 B，最终致使现象 C 出现" 这种形式。
(2) ⚠️ 机制A、参数B、现象C都必须在子问答对中有明确提及

###2. 周密性：
(1) 思维过程要科学且严谨，需逐步思考。
(2) ⚠️ 推理过程必须基于子问答对的内容

###3.可追溯性（严格执行）：
(1) 问题必须源于子问答对内容（⚠️ 子问答对是专家验证正确的）
(2) 针对问题的答案也在子问答对中要有详细描述
(3) 问题涉及的所有技术概念、参数、现象都必须在子问答对中出现
(4) ⚠️ 不能引入子问答对中没有的信息
(5) 但问题不能特指论文（禁止不具有通用性）

###4.问题通用性（严格执行）：
(1) 问题禁止太绝对，问题必须具有通用性，不只是局限于文本中，禁止特指论文。
    示例：
        错误示例：在金属氧化物薄膜晶体管(MOTFT)中，Nd掺杂Al合金栅极材料经300℃热处理后的电阻率具体数值是多少μΩ·cm？（错误原因：特指论文，不同材料厚度比例数值不一样。）
        正确示例：如何在室温溅射工艺中精确调控氧分压参数与后退火温度条件，以同步实现氧化物薄膜晶体管的高迁移率特性与在电学/光学复合应力下的长期稳定性？（不是特指论文，具有通用性）

(2) 不能在问题中引用论文文献或文章自定义的专有名词，确保不读论文也能理解问题含义。（严格执行）

###5.完整性：
(1) 问题是否全面涵盖文章相关内容的各个方面？
(2) 问题描述应简洁凝练，语义完整。
(3) 问题要与文章内容完全独立，不依赖文章也能被清晰理解，即问题需完整、自足。
(4) 问题能基于文章内容回答，但没有特指论文
(5) ⚠️ 问题不得包含子问答对中没有的信息

###6.单一性（必须严格执行）
###6.单一性（必须严格执行）

**(1) 基本要求**
每个问题只包含一个问题，禁止连接多个子问题或者在一个句子中包含多个疑问点。

**(2) 特别注意：对比类问题（新增）**
以下是**伪装成单一问题的复合问题**，必须判为❌：
- "为什么A材料...，而B材料...？" ❌（2个疑问：A的原因+B的原因+对比）
- "在条件X下，为什么现象Y发生，而在条件Z下现象W发生？" ❌（2个独立疑问）
- "材料A如何...，相比材料B的...机制是什么？" ❌（2个疑问）

**正确的单一问题**：
✅ "为什么在IGZO中，当In₂O₃含量超过88%时，器件稳定性会下降？"
✅ "金属氧化物半导体材料为什么在直流电压应力下阈值电压漂移较小？"
✅ "相比非晶硅，金属氧化物半导体材料为什么稳定性更好？"（单一对比，聚焦一个材料）

❌ "为什么在IGZO中In₂O₃>88%稳定性下降，而金属氧化物材料表现更好？"（两个独立疑问）
❌  "在薄膜晶体管沟道材料应用中，铟镓锌氧化物（IGZO）相较于非晶硅（a-Si）为何能在保持非晶结构的同时实现高出1-2个数量级的电子迁移率，这种材料特性差异如何从根本上解决大尺寸液晶显示器的驱动瓶颈？"

###7. ⚠️⚠️ 准确性检查（新增，最重要）：
(1) 问题中涉及的所有技术概念、参数、数据是否都在子问答对中出现？
(2) 问题是否引入了子问答对中没有的信息？
(3) 问题的技术描述是否准确，没有事实错误？
(4) 如果问题引入了子问答对中没有的内容，必须判【否】

---

[子问答对内容的开始]
{sub_qa_content}
[子问答对内容的结束]

[问题如下]
{academic_question}

---

## 【评判流程】

第1步：检查问题涉及的所有技术点是否都在子问答对中出现
- 如果有任何技术点、数据、结论不在子问答对中 → 直接判【否】

第2步：检查6个标准是否全部通过
- 只有全部通过才输出【是】
- 任何一个不通过就是【否】

第3步：输出结果

评判标准要求：认真思考，**首先检查准确性（是否基于子QA），然后检查6个标准**，全部通过才输出【是】，只要有一个不通过就是【否】。

格式要求：仅输出文本内容生成的问题是否符合标准，严格按以下格式，有且仅输出【是】或者【否】，不输出任何别的内容，不能输出为空，输出是或否时，要带上【】符号进行输出。用中文输出，严格按照以下格式进行输出：【是】或者【否】（严格执行！！）
"""

    # ========== ⭐⭐⭐ 答案重新生成模板（强化版：严格基于子QA）==========
    
    answer_regeneration = """您是一位半导体领域专家，负责为给定的多跳推理问题生成准确、完整的答案。

⚠️⚠️⚠️ **核心原则（必须严格遵守，这是最重要的）**：

1. **子问答对是专家验证过的正确内容**，是你的唯一信息来源
2. **必须严格基于子问答对，不要发散**，不要引入外部知识
3. **答案的每一句话都必须能在子问答对中找到依据**
4. **不得编造、推测、发散**，垂域模型发散容易引入错误
5. **围绕子QA写，不要过于发散**

# 问题
{question}

# 参考答案（仅作参考，可能不完整，你需要重新生成更好的答案）
{reference_answer}

# 子问答对（⚠️⚠️ 这是专家验证正确的，你的唯一信息来源，必须严格基于这些内容）
{sub_qa_pairs}

# 推理步骤
{reasoning_steps}

---

<think>
⚠️ 在开始之前，我必须明确几个关键点：

1. **子问答对是专家验证过的正确内容**
   - 这些内容是经过专家审核的，是可信的
   - 我只能基于这些内容生成答案
   - 我不能引入任何这些子QA之外的信息

2. **我的任务**：
   - 仔细阅读所有子问答对的内容
   - 识别问题需要的推理链条
   - 逐步构建推理过程，确保每一步都有子QA支撑
   - 生成完整答案，体现推理链，但答案要自然、连贯

3. **核心检查**（生成后必须自检）：
   - 答案的每一句话是否都能在子QA中找到依据？
   - 有没有引入子QA中没有的数据、概念、结论？
   - 有没有使用"可能"、"通常"等推测（除非子QA中有）？
   - 有没有发散到相关但未提及的技术点？
   
   ⚠️ 如果答案中有任何一句话脱离了子QA，必须删除！

4. **答案策略**：
   - 围绕子QA写，不要过于发散
   - 答案越贴近子QA原文越好
   - 推理过程要清晰，但每一步都要基于子QA
   - 宁可答案简短，也不要编造内容
</think>

## 【答案生成准则】（严格执行）

### 1. ⚠️⚠️ 基于子QA，不发散（最高优先级）

**必须做到**：
- ✅ 答案的每一句话都必须有子问答对的支撑
- ✅ 每提到一个数据、结论、机制，必须能在子QA中找到原文
- ✅ 推理过程只能基于子QA中的信息进行逻辑组合
- ✅ 不得引入子QA中没有提到的概念、数据、结论
- ✅ 如果子QA信息不足，宁可答案简短，也不要编造
- ✅ 围绕子QA写，不要过于发散

**严禁做的**：
- ✗ 禁止使用子QA外的专业知识
- ✗ 禁止发散到相关但未提及的技术点
- ✗ 禁止引入"可能"、"通常"、"一般"等推测（除非子QA中有）
- ✗ 禁止编造数据、参数、结论
- ✗ 禁止过度发散（垂域模型容易引入错误）

**示例对比**：

❌ 错误答案（引入了子QA外的信息）：
```
"氧分压通过调控氧空位浓度影响载流子迁移率，进而影响TFT的开关速度和功耗。
同时，合适的氧分压还能优化界面态密度，减少电荷陷阱，提高器件稳定性。"
                                    ↑ 如果子QA中没有提到"界面态密度"和"电荷陷阱"，这就是错误的
```

✅ 正确答案（严格基于子QA）：
```
"氧分压通过调控氧空位浓度影响载流子迁移率。[来自子QA-1]
较高的氧分压降低氧空位浓度，提升迁移率。[来自子QA-1]
同时，优化的退火温度可以进一步改善薄膜质量。[来自子QA-2]"
```

### 2. 完整性

- ✅ 答案必须完整回答问题的所有方面
- ✅ 体现推理过程（但要自然，不要生硬列举步骤）
- ✅ 答案长度：80-200字
- ✗ 禁止仅引导句
- ✗ 禁止只回答部分问题

### 3. 推理链体现

- ✅ 答案应自然地体现：通过A → 推导到B → 得出C
- ✅ 使用逻辑连接词："由于...因此..."、"通过...可以..."
- ✅ 推理步骤要清晰，但表达要流畅
- ✅ **但每一步都必须基于子QA的内容**
- ✗ 禁止机械地列举"第一步、第二步"

### 4. 通用性

- ✅ 答案具有通用性，不特指论文
- ✅ 使用通用的技术术语
- ✗ 禁止使用"本文"、"本研究"等表述
- ✗ 禁止引用文献

### 5. 准确性验证（⚠️ 生成后必须自检）

生成答案后，逐句自问：
- [ ] 这句话在哪个子QA中有依据？
- [ ] 这个数据在子QA中出现过吗？
- [ ] 这个结论是从子QA推导的，还是我自己加的？
- [ ] 我有没有引入外部知识？
- [ ] 我有没有发散到子QA未提及的内容？
- [ ] 我有没有使用"可能"、"通常"等推测？

**如果答案无法通过上述检查，必须修改或删除相关内容！**

## 【答案策略】

根据问题类型选择策略，但始终基于子QA：
- **因果推理**：体现 原因 → 机制 → 结果（每一步都在子QA中）
- **参数影响**：体现 参数变化 → 性能影响 → 最终效果（每一步都在子QA中）
- **工艺优化**：体现 工艺条件 → 材料特性 → 器件性能（每一步都在子QA中）

## 【禁止事项】（⚠️ 严格执行）

× 禁止引入子QA中没有的信息（最严重错误）
× 禁止编造数据、参数、结论（最严重错误）
× 禁止使用"可能"、"通常"、"一般来说"等推测（除非子QA中有）
× 禁止发散到相关但未提及的技术
× 禁止使用"本文/本研究/本实验"等论文自指
× 禁止答案不完整（仅引导句）
× 禁止过度发散（垂域模型容易引入错误）

---

输出JSON格式(严格按下面格式输出)：
```json
{{
    "final_answer": "最终生成的完整答案（80-200字，严格基于子QA，体现推理链，围绕子QA写，不发散）",
    "reasoning_trace": "推理轨迹（30-50字，说明如何从子QA推导到答案，每一步都要指出来源）",
    "confidence": 0.0-1.0,
    "grounded_check": {{
        "all_info_from_subqa": true/false,
        "no_external_knowledge": true/false,
        "complete_reasoning": true/false,
        "no_speculation": true/false
    }}
}}
```

⚠️ **最后提醒**：
- 子问答对是专家验证过的正确内容，是你的唯一信息来源
- 不要引入任何外部知识
- 不要编造、推测、发散
- 每句话都要有子QA的支撑
- 围绕子QA写，不要过于发散
- 如果生成的答案无法通过"grounded_check"检查，说明你引入了外部信息，必须重新生成！
"""

    # ========== Action选择（完全保留原版）==========
    action = '''你是一个半导体领域的QA构建专家。基于当前问答对和相关信息，必须选择一个操作来提升问题难度。

# 当前问答对
{question}

# 可选操作
{actions}

输出JSON格式（根据选择的操作）：
见下方各操作的详细格式
'''

    SELECT = '''SELECT: 从相关QA实体列表中选择一个ID，融入问题以增加推理深度。

⚠️⚠️⚠️ **严格要求**：
1. **target必须是下面"相关QA实体列表"中的ID**
2. **禁止编造不存在的ID**
3. **只能从列表中选择，不能选择其他任何ID**

**可选ID列表**：
{available_ids}

输出JSON格式(严格按下面格式输出)：
```json
{{
    "action": "SELECT",
    "target": "从上面列表中选1个ID（⚠️只能选列表中的ID）",
    "note": "选择该概念的理由（说明如何增加推理深度，20-40字）"
}}
```

**示例**：
如果可选ID列表是：47, 63, 128
则target只能是："47"或"63"或"128"
禁止输出："7496"、"6083"等不在列表中的ID
'''

    FUZZ = '''FUZZ: 模糊化问题中的1处信息，使问题更具挑战性，需要更多推理。

输出JSON格式：
```json
{{
    "action": "FUZZ",
    "question": "模糊化后的问题（清晰、可解、更具挑战）",
    "note": "为何以及如何进行模糊化（20-40字）"
}}
```
'''

    EXIT = '''EXIT: 当问题满足退出条件时选择退出。

输出JSON格式：
```json
{{
    "action": "EXIT",
    "note": "为何选择退出（说明问题已满足质量标准，20-40字）"
}}
```
'''

    BRAINSTORM = '''BRAINSTORM: 头脑风暴与当前问答对相关的半导体概念，用于后续融入问题。

输出JSON格式：
```json
{{
    "action": "BRAINSTORM",
    "entities": [
        {{
            "name": "概念名称（准确、专业）",
            "concept_id": "概念在知识库中的ID（如果有，否则为null）",
            "statement": "连接该概念与当前问答的事实陈述（20-50字）"
        }}
    ]
}}
```
'''   


    # ========== 辅助Prompts ==========
    
    # ⭐ 优化：改为更简洁的字典格式（而非列表）
    extract_key_concepts = '''从以下半导体知识内容中提取关键技术概念。

内容：
```txt
{content}
```

⚠️ **提取要求**：
1. 提取3-8个最核心的技术概念
2. 概念应涵盖：材料、工艺、器件、参数、效应等
3. 概念名称要准确、专业
4. 避免过于宽泛的概念（如"半导体"、"材料"）

输出JSON格式(严格按下面格式输出)：
```json
{{
    "concepts": [
        {{
            "name": "概念名称",
            "type": "材料/工艺/器件/效应/参数",
            "importance": "high/medium/low"
        }}
    ]
}}
```

**示例输出**：
```json
{{
    "concepts": [
        {{"name": "铟镓锌氧化物", "type": "材料", "importance": "high"}},
        {{"name": "氧分压", "type": "工艺", "importance": "high"}},
        {{"name": "载流子迁移率", "type": "参数", "importance": "medium"}},
        {{"name": "薄膜晶体管", "type": "器件", "importance": "high"}}
    ]
}}
```
'''

    summarize_qa = '''总结以下半导体问答对的核心技术要点。

问答对：
```txt
问题: {question}
答案: {answer}
```

输出格式(严格按下面格式输出)：
<summary>核心技术摘要（30-50字）</summary>
<key_points>
- 关键点1
- 关键点2
- 关键点3
</key_points>
'''

    check_info_cover = '''**核心问题**：新陈述是否提供了先前陈述中没有的新信息？

判断标准：
- 如果新陈述只是重复或改写先前陈述 → judgement: "yes"（重复）
- 如果新陈述包含先前陈述中没有的新技术点/参数/材料 → judgement: "no"（有新信息）

示例1（重复）：
先前: "采用低温工艺和聚芴聚合物" 新: "使用聚芴聚合物并采用低温工艺" judgement: "yes"（只是改写，没有新信息）


示例2（有新信息）：
先前: "采用低温工艺和聚芴聚合物" 新: "采用低温工艺、聚芴聚合物，并引入Al₂O₃栅极绝缘层" judgement: "no"（有新信息：Al₂O₃）


先前的技术陈述：
```txt
{prior}
```

待检查的陈述：
```txt
{current}
```

输出JSON格式(严格按下面格式输出)：
```json
{{
    "judgement": "yes 或 no",
    "analysis": "简要分析（20字内）"
}}
```
'''

    check_alternative_ans = '''你是一个半导体领域的专业评估专家。判断预测答案是否也是该问题的正确答案（即使与标准答案表述不同）。

问题: {question}

标准答案: {gt_answer}

支撑标准答案的技术事实：
```txt
{statements}
预测答案: {pred_answer}

【判断原则】（严格执行）
核心原则：预测答案必须基于技术事实且准确回答问题
1. 判断为 "yes"（预测答案也正确）的条件
必须同时满足以下所有条件：

(1) 基于技术事实

预测答案中的关键信息必须能在"技术事实"中找到支撑
不得引入技术事实中没有的数据、结论、机制
不得与技术事实矛盾
(2) 准确回答问题

预测答案必须直接回答问题的核心要求
如果问题问"是多少"，必须给出具体数值
如果问题问"如何"，必须给出具体方法
如果问题问"为什么"，必须给出正确机制
(3) 技术正确性

数值/参数准确（与标准答案一致或在合理范围内）
材料名称准确
工艺方法正确
技术机制正确
(4) 表述合理

可以比标准答案更详细（但不能引入错误信息）
可以使用不同表述（但核心信息必须一致）
可以有不同的组织方式
2. 判断为 "no"（预测答案错误）的情况
以下任一情况判定为错误：

(1) 关键信息错误

❌ 数值/参数错误（如标准答案"1200℃"，预测答案"500℃"）
❌ 材料名称错误或模糊（如标准答案"聚芴聚合物"，预测答案"合适的材料"）
❌ 工艺方法错误（如标准答案"固相烧结"，预测答案"溅射沉积"）
❌ 技术机制错误或相反
(2) 未基于技术事实

❌ 引入了技术事实中没有的信息
❌ 与技术事实矛盾
❌ 使用通用知识替代技术事实
(3) 未回答问题核心

❌ 泛泛而谈，没有具体信息（如问"用什么材料"，答"用合适的材料"）
❌ 回答了相关但不是问题要求的内容
❌ 遗漏问题的关键要求
(4) 表述不专业

❌ 包含推测性表述（"可能"、"通常"），但技术事实中明确给出了答案
❌ 过度简化导致信息丢失
【判断示例】
示例1：数值类问题
问题: "烧结温度需要达到多少才能形成单相InGaZnO₄？" 标准答案: "1200℃以上" 技术事实: "当温度升至1200℃以上时，In³⁺、Ga³⁺、Zn²⁺离子获得足够热能实现长程扩散，形成单相InGaZnO₄结构。"

预测答案A: "1200℃以上，此时离子能充分扩散形成单相结构。" 判断: yes 理由: 数值准确，解释基于技术事实

预测答案B: "至少需要1250℃。" 判断: yes 理由: 1250℃>1200℃，符合"1200℃以上"的要求

预测答案C: "通常在500-600℃。" 判断: no 理由: 数值错误，与技术事实矛盾

预测答案D: "需要高温烧结。" 判断: no 理由: 未给出具体数值，问题要求明确

示例2：材料类问题
问题: "柔性TFT应选用什么半导体材料？" 标准答案: "聚芴聚合物" 技术事实: "选用聚芴聚合物作为有机半导体材料，配合PET基板，在≤80°C低温工艺下制备。"

预测答案A: "聚芴类有机半导体材料。" 判断: yes 理由: 等价表述，基于技术事实

预测答案B: "选择合适的有机半导体材料。" 判断: no 理由: 未给出具体材料，过于模糊

预测答案C: "聚芴聚合物，它可以在低温下制备并兼容PET基板。" 判断: yes 理由: 核心信息准确，额外信息基于技术事实

示例3：方法类问题
问题: "如何提高柔性显示器在弯曲条件下的电学稳定性？" 标准答案: "通过增加层间电介质厚度，采用顶栅底接触结构，减少栅漏寄生电容。" 技术事实: "通过增加层间电介质厚度优化器件结构（如顶栅底接触或底栅底接触结构），减少栅漏寄生电容和像素电极干扰，可使显示器在弯曲条件下保持电学性能稳定。"

预测答案A: "采用顶栅底接触结构，增加电介质层厚度，从而降低寄生电容和电极干扰，提高弯曲稳定性。" 判断: yes 理由: 方法准确，机制正确，基于技术事实

预测答案B: "通过优化材料和结构设计可以提高弯曲稳定性。" 判断: no 理由: 泛泛而谈，未给出具体方法

预测答案C: "选择合适的电泳材料、优化电极设计、增强基板柔韧性。" 判断: no 理由: 这些方法未在技术事实中提及

示例4：机制类问题
问题: "为什么增加介质厚度可以提高弯曲稳定性？" 标准答案: "因为可以减少栅漏寄生电容和像素电极干扰。" 技术事实: "通过增加层间电介质厚度优化有机薄膜晶体管器件结构，减少栅漏寄生电容和像素电极干扰，可使显示器在弯曲条件下保持电学性能稳定。"

预测答案A: "增加介质厚度能够降低寄生电容，减少电极间相互干扰，从而在弯曲时保持性能稳定。" 判断: yes 理由: 机制正确，基于技术事实

预测答案B: "增加介质厚度可以提高电容值，改善器件性能。" 判断: no 理由: 机制相反（减少vs提高电容）

预测答案C: "更厚的介质层可以提供更好的机械支撑。" 判断: no 理由: 这个机制未在技术事实中提及

【输出格式】（严格遵循JSON）
{{
    "judgement": "yes 或 no",
    "reason": "判断理由（30字内）"
}}
'''

    qa_valid_check = '''检查该半导体问答对的有效性。

⚠️ **核心检查原则**：
1. 问题和答案必须基于给定的子问答对（子问答对是专家验证正确的）
2. 不得引入子问答对中没有的事实、数据、结论
3. 答案必须围绕子问答对，没有过于发散

问答对有效当且仅当：
1. 问题不是简单拼接多个问题
2. 提供的答案是唯一正确答案
3. 问题有唯一答案
4. 基于相关技术陈述可以解答
5. 问题答案语法合理，可读性强
6. 问题没有事实错误
7. 答案中没有事实错误
8. ⚠️ 答案围绕子问答对回答的，没有过于发散
9. ⚠️ 答案没有引入子问答对中没有的信息
10. ⚠️ 问题涉及的所有技术点都在子问答对中有明确提及

完整的问答对信息（包含问题、答案、相关QA和技术陈述）：
{question}

输出JSON格式(严格按下面格式输出)：
```json
{{
    "judgement": "yes 或 no",
    "analysis": "分析说明（50字内，如果判no，必须指出具体原因）"
}}
```
'''

    direct_gen_check = """你是一个半导体领域的资深技术专家，拥有深厚的专业知识。请认真阅读以下问题，基于半导体专业知识给出准确、具体的答案。

问题：
{question}

## 【回答要求】（严格执行）

### 1. 专业性
- 必须基于半导体领域的专业知识回答
- 不要使用模糊、笼统的表述
- 避免泛泛而谈的通用建议

### 2. 准确性
- 如果问题涉及具体数值/参数/材料名称，必须给出具体信息
- 禁止使用"合适的材料"、"适当的温度"等模糊表述
- 如果涉及工艺条件，明确说明具体参数

### 3. 简洁性
- 答案应简洁、直接，直击问题核心
- 控制在50-150字（除非问题需要详细解释）
- 避免冗余的背景介绍

### 4. 具体性
- 优先回答问题的核心要求（如数值、材料、机制）
- 如果问题问"如何"，给出具体方法和关键参数
- 如果问题问"为什么"，解释核心机制

### 5. 避免推测（关键）
- 只基于确定的专业知识回答
- **如果不确定，说"需要根据具体工艺条件确定"，不要编造**
- 禁止使用"可能"、"通常"、"一般来说"（除非确实存在多种情况）

## 【错误示例 vs 正确示例】

❌ 错误回答（模糊、泛泛）：
问题: "IGZO薄膜沟道的退火温度是多少？"
错误答案: "退火温度通常在300-400°C之间，具体取决于工艺要求和设备条件。"
问题: 太模糊，没有给出明确答案

✅ 正确回答（具体、准确）：
问题: "IGZO薄膜沟道的退火温度是多少？"
正确答案: "IGZO薄膜沟道的退火温度一般为350°C，在氧气或空气气氛下保持30-60分钟，以优化氧空位浓度和载流子迁移率。"
优点: 给出了具体温度、气氛、时间

---

❌ 错误回答（用通用知识代替具体知识）：
问题: "在InGaZnO₄靶材制备中，烧结温度需要达到多少？"
错误答案: "InGaZnO₄材料的烧结温度通常在500-600°C。"
问题: 混淆了薄膜沉积和靶材烧结

✅ 正确回答（区分上下文）：
问题: "在InGaZnO₄靶材制备中，烧结温度需要达到多少？"
正确答案: "InGaZnO₄靶材采用固相反应法制备时，烧结温度需要达到1200°C以上，以确保In³⁺、Ga³⁺、Zn²⁺离子充分扩散，形成单相InGaZnO₄结构。"
优点: 明确了是靶材制备（不是薄膜），给出了1200°C这个关键数值

---

❌ 错误回答（过于简略）：
问题: "如何通过优化器件结构提高柔性显示器的弯曲稳定性？"
错误答案: "通过优化材料和结构可以提高弯曲稳定性。"
问题: 没有任何具体信息

✅ 正确回答（具体方法）：
问题: "如何通过优化器件结构提高柔性显示器的弯曲稳定性？"
正确答案: "采用以下方法：1) 选择柔性基板材料（如PET、PI）；2) 增加层间电介质厚度以减少寄生电容；3) 采用顶栅底接触或底栅底接触结构；4) 优化有机半导体材料的成膜工艺，确保在弯曲条件下载流子迁移率波动<10%。"
优点: 给出了4个具体方法和关键参数

## 【输出格式】（严格遵循）

<answer>
[你的简洁、准确、具体的答案，50-150字]
</answer>

⚠️ 注意：
- 必须用 <answer></answer> 标签包裹
- 答案直接回答问题，不要加"根据题意"、"综上所述"等冗余表述
- 如果问题涉及数值/参数，必须给出具体数值
- 不要编造数据，如果不确定就说明需要根据具体情况确定
"""


    llm_judge = """你是一个半导体领域的专业评估专家。你的任务是判断预测答案是否正确回答了问题。

问题: {question}

标准答案: {gt_answer}

预测答案: {pred_answer}

---

## 【判断标准】（严格执行）

### 核心原则：判断预测答案是否**准确回答了问题的核心要求**

### 1. 关键信息匹配（最重要）

**(1) 数值/参数必须准确**
- 温度、电压、电流、厚度、浓度等数值必须一致（允许±5%误差）
- 例如：标准答案"1200℃"，预测答案"500-600℃" → **Incorrect**
- 例如：标准答案"1200℃以上"，预测答案"1250℃" → **Correct**

**(2) 材料名称必须准确**
- 材料名称必须一致或等价
- 例如：标准答案"聚芴聚合物"，预测答案"合适的聚合物" → **Incorrect**
- 例如：标准答案"聚芴聚合物"，预测答案"聚芴类有机半导体" → **Correct**

**(3) 工艺方法必须一致**
- 关键工艺步骤必须匹配
- 例如：标准答案"固相反应烧结"，预测答案"溅射沉积" → **Incorrect**

**(4) 技术机制必须正确**
- 解释的核心机制必须一致
- 例如：标准答案"通过增加介质厚度减少寄生电容"，预测答案"通过增加介质厚度提高电容" → **Incorrect**

### 2. 允许的差异

以下情况视为**等价**（Correct）：
- ✅ 表述顺序不同，但信息完整
- ✅ 使用同义词或等价术语（如"PET" = "聚对苯二甲酸乙二醇酯"）
- ✅ 预测答案更详细，但包含了标准答案的核心信息
- ✅ 数值在合理误差范围内（±5%）

### 3. 不允许的差异

以下情况判定为**错误**（Incorrect）：
- ❌ 关键数值差异超过±5%
- ❌ 材料名称不匹配或用模糊表述（"合适的材料"）
- ❌ 技术机制错误或相反
- ❌ 预测答案泛泛而谈，没有给出具体信息
- ❌ 预测答案遗漏了问题的核心要求
- ❌ 预测答案引入了标准答案中没有的错误信息

### 4. 特殊情况

**(1) 问题问"如何"（方法类）**
- 预测答案必须包含标准答案中的**核心方法**
- 可以有额外的合理建议，但不能缺少核心方法
- 如果预测答案只是泛泛而谈（如"优化材料"），判定为 **Incorrect**

**(2) 问题问"为什么"（机制类）**
- 预测答案必须正确解释**核心机制**
- 表述可以不同，但机制必须一致

**(3) 问题问"是多少"（数值类）**
- 预测答案必须给出**具体数值**，且与标准答案一致（±5%）
- 如果给出错误数值或范围，判定为 **Incorrect**

---

## 【判断示例】

### 示例1：数值类问题

问题: "在InGaZnO₄靶材制备中，烧结温度需要达到多少？"
标准答案: "1200℃以上"
预测答案: "1200℃以上，以确保离子充分扩散形成单相结构。"
判断: **Correct**（数值一致，额外解释合理）

---

问题: "在InGaZnO₄靶材制备中，烧结温度需要达到多少？"
标准答案: "1200℃以上"
预测答案: "InGaZnO₄的烧结温度通常在500-600℃。"
判断: **Incorrect**（数值错误，相差一倍以上）

---

### 示例2：材料类问题

问题: "柔性TFT应选用什么半导体材料？"
标准答案: "聚芴聚合物"
预测答案: "聚芴类有机半导体材料"
判断: **Correct**（等价表述）

---

问题: "柔性TFT应选用什么半导体材料？"
标准答案: "聚芴聚合物"
预测答案: "选择合适的有机半导体材料"
判断: **Incorrect**（没有给出具体材料）

---

### 示例3：方法类问题

问题: "如何提高柔性显示器的弯曲稳定性？"
标准答案: "通过增加层间电介质厚度、采用顶栅底接触结构、选择聚芴聚合物材料。"
预测答案: "通过优化材料和结构设计可以提高弯曲稳定性。"
判断: **Incorrect**（泛泛而谈，没有具体方法）

---

问题: "如何提高柔性显示器的弯曲稳定性？"
标准答案: "通过增加层间电介质厚度、采用顶栅底接触结构、选择聚芴聚合物材料。"
预测答案: "采用聚芴聚合物作为半导体材料，增加电介质层厚度，使用顶栅结构，这样可以减少寄生电容并提高机械稳定性。"
判断: **Correct**（包含了所有核心方法，额外解释合理）

---

### 示例4：机制类问题

问题: "为什么增加介质厚度可以提高弯曲稳定性？"
标准答案: "增加介质厚度可以减少栅漏寄生电容和像素电极干扰。"
预测答案: "增加介质厚度能够降低寄生电容，减少电极间的相互干扰。"
判断: **Correct**（机制一致，表述略有不同）

---

问题: "为什么增加介质厚度可以提高弯曲稳定性？"
标准答案: "增加介质厚度可以减少栅漏寄生电容和像素电极干扰。"
预测答案: "增加介质厚度可以提高电容值，从而改善器件性能。"
判断: **Incorrect**（机制相反："减少电容"vs"提高电容"）

---

## 【输出格式】（严格遵循）

仅输出以下两个词之一，不要包含任何其他文字：

- **Correct**（预测答案正确）
- **Incorrect**（预测答案错误）

⚠️ 严格要求：
- 只输出 "Correct" 或 "Incorrect"
- 不要输出 "正确"、"错误"、"是"、"否"
- 不要输出任何解释、标点符号、换行
- 输出后立即结束，不要添加任何额外内容
"""


    # ========== 桥联合理性检查（保留原版）==========
    
    check_bridge_validity = '''你是一个半导体领域的技术专家。判断两个QA之间的桥联是否合理。

# QA-1 信息
问题: {qa1_question}
答案: {qa1_answer}
关键概念: {qa1_concepts}

# QA-2 信息
问题: {qa2_question}
答案: {qa2_answer}
关键概念: {qa2_concepts}

# 桥联声明
{statement}

## 【判断标准】

### 合理的桥联应满足：

1. **技术相关性**
   - 两个QA涉及相同或相关的技术领域
   - 例如：都涉及TFT沟道、都涉及材料制备、都涉及同一工艺参数

2. **逻辑连贯性**
   - 从QA-1推理到QA-2有明确的逻辑路径
   - 不是简单的表面概念重叠

3. **知识深度**
   - 桥联能够揭示更深层的技术关联
   - 不是泛泛而谈的"都涉及半导体"或"都涉及材料"

### ❌ 不合理的桥联示例

**示例1（器件组件不同）**：
```
QA-1: IGZO沟道材料的氧化铟含量控制
QA-2: 铝栅极材料的小丘抑制
桥联: "都涉及材料和掺杂策略"
判断: ❌ 不合理
原因: 沟道和栅极是不同的器件组件，技术关联太弱
```

**示例2（领域跨度太大）**：
```
QA-1: TFT的迁移率优化
QA-2: 显示器的色域标准
桥联: "都与显示技术相关"
判断: ❌ 不合理
原因: 器件性能和显示效果关联太远
```

### ✅ 合理的桥联示例

**示例1（同一材料的不同工艺）**：
```
QA-1: IGZO薄膜的氧分压控制
QA-2: IGZO薄膜的退火温度优化
桥联: "氧分压和退火温度共同影响IGZO薄膜的氧空位浓度"
判断: ✅ 合理
原因: 同一材料（IGZO）的相关工艺参数，有明确的技术关联
```

## 【评分标准】

**相关性分数**（0-10分）：
- **9-10分**：强相关（同一器件/材料/工艺的不同方面）
- **6-8分**：中等相关（相关技术领域）
- **3-5分**：弱相关（表面概念重叠）
- **0-2分**：不相关（不同技术领域）

**合格线**：相关性分数 ≥ 6分

## 【输出格式】（严格遵循JSON）

```json
{{
    "judgement": "yes 或 no",
    "analysis": "分析说明（50字内，说明为何合理或不合理）",
    "relevance_score": 0-10
}}
```
'''
